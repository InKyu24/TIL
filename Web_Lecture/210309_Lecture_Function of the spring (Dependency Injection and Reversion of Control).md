# 스프링 의존성 주입과 제어 역전 기능

자바와 같은 객체 지향 프로그래밍 언어에서 클래스는 특정 기능을 수행하는 부품 역할을 한다. 어떤 부품을 사용하다가 이상이 생기거나 오래 되면 다른 부품으로 교체해서 사용하듯, 애플리케이션해서도 사용자의 요구 사항에 따라 클래스의 기능을 변경하거나 다른 클래스 기능으로 대체해야 하는 경우가 자주 생긴다. 이러한 상황에서 좀 더 수월하게 대체할 수 있도록 도입된 기능이 바로 의존성 주입(DI)와 제어 역행(IoC)이다.



## 의존성 주입하기

지금까지 어떤 한 클래스가 다른 클래스의 기능을 사용하려면 개발자가 직접 코드에 사용할 클래스의 생성자를 호출해서 사용했다. 즉, 사용할 클래스와 사용될 클래스의 관계는 개발자에 의해 직접 코드에서 부여된다.

의존성 주입이란 이런 연관 관계를 개발자가 직접 코딩을 통해 컴포넌트(클래스)에 부여하는 것이 아니라 컨테이너가 연관 관계를 직접 규정하는 것이다. 그러면 코드에서 직접적인 연관 관계가 발생하지 않으므로 각 클래스들의 변경이 자유로워진다.

전체 애플리케이션은 각각의 기능을 담당하는 컴포넌트들로 이루어진다. 그리고 각 컴포넌트들은 다시 세부 기능을 수행하는 클래스들로 이루어진다. 그런데 컴포넌트를 이루는 클래스들이 다른 클래스의 기능을 사용하려면 어떻게 해야 할까? 소스 코드에서 다른 클래스의 생성자를 호출해서 사용할 경우 기능을 구현하는 과정에서 달느 변경 사항이 발생하면 빠르게 대처하기가 어렵다. 또다시 관련이 있는 모든 클래스들의 소스 코드를 수정해 주어야 하기 때문이다.

따라서 스프링 프레임워크에서는 각 클래스들의 연관 관계를 클래스들 사이에서 맺는 것이 아니라 스프링 프레임워크에서 설정을 통해 맺어줌으로써 클래스들이 연관 관계를 갖지 않게 구현했다.



### 의존성 주입을 사용하기 전 게시판 기능 [Textbook19_1]

의존성 주입을 사용하기 전에는 다른 클래스의 기능르 사용하기 위해서는 객체를 코드에서 직접 생성한 후에 메서드를 호출하여 연동하였다. 그리고 DAO 클래스에서는 오라클을 연동해 구현하고 있는 상황인 경우, 오라클에서 MySQL로 데이터베이스를 변경한다고 가정해보자. 이를 위해서는 일일이 DAO 클래스의 기능을 변경해주어야 한다. 뿐만 아니라 경우에 따라서는 DAO 클래스를 사용하는 Service 클래스의 기능도 변경해야 할 수도 있다.

프로젝트의 규모가 점점 커지는 상황에서 자바 코드에서 클래스 생성자를 호출해 객체를 생성하는 방법은 복잡한 문제를 일으킬 수도 있다. 즉, 자바 코드에서 직접 객체를 생성해 사용하는 방법은 다른 클래스의 변경 사항이 연속적으로 다른 부분에 영향을 미친다면 좋은 방법이 아닐 것이다.



### 인터페이스를 적용한 게시판 기능 [Textbook19_2]

그렇다면 이러한 문제점을 인터페이스를 사용해서 해결해보자. 인터페이스를 이용해 하위 클래스 객체를 생성한 후 오라클 데이터베이스와 연동하면 될 것이다. 

여기서 MySQL과 연동하는 기능이 생겼다고 가정해보자. 인터페이스로 구현한 경우에는 기존의 DAOImpl 클래스를 변경할 필요가 없다. DAO 인터페이스를 구현한 또 다른 DAOImpl 클래스를 구현한 후에 ServiceImpl 클래스에서 사용하면 되기 때문이다.

인터페이스를 이용해 각 클래스를 구현한 후 각 클래스의 객체를 사용할 때는 인터페이스 타입으로 선언한 참조 변수로 접근해서 사용하면 된다. 그러면 완전하지는 않아도 훨씬 클래스들 간의 의존 관계가 약해진다. 하지만 인터페이스를 사용하더라도 ServiceImpl 클래스 자체는 여전히 소스 코드에서 직접 수정해야 한다.



### 의존성 주입을 적용한 게시판 기능 [Textbook19_3]

클래스들의 의존 관계가 강하게 결합되어 있으면 여러 가지 문제가 발생할 수 있다. 스프링의 의존성 주입 기능을 이용해 각 클래스들 사이의 의존 관계를 완전히 분리하는 작업을 해보자.

의존성 주입을 적용했을 때 얻을 수 있는 장점들을 요약하면 아래와 같다.

+ 클래스들 간의 의존 관계를 최소화하여 코드를 단순화할 수 있다.
+ 애플리케이션을 더 쉽게 유지 및 관리할 수 있다.
+ 기존 구현 방법은 개발자가 직접 코드 안에서 객체의 생성과 소멸을 제어했다. 하지만 의존성 주입은 객체의 생성, 소멸과 객체 간의 의존 관계를 컨테이너가 제어한다.

스프링에서 의존성 주입(이하 DI)을 구현하려면 XML이나 애너테이션을 이용해 객체를 주입하여 객체들의 의존 관계를 맺어주면 된다. 즉, DI를 사용하여 각 객체들 간의 의존 관계를 최소화함으로써 코드를 단순화하고 유지보수를 쉽게 할 수 있다.

DI는 객체의 생성, 소멸, 의존 관계를 개발자가 직접 설정하는 것이 아니라 XML이나 애너테이션 설정을 통해 경량 컨테이너에 해당하는 스프링 프레임워크가 제어한다. 따라서 기존 코드에서는 개발자가 직접 객체를 제어했지만 스프링 프레임워크에서는 객체의 제어를 스프링이 직접 담당하므로 제어의 역전(이하 IoC)이라고 하는 것이다. IoC의 종류도 여러 가지이며, 일반적으로 스프링에서는 DI로 IoC의 기능을 구현하므로 IoC보다는 DI라는 용어를 더 많이 사용하는 것이다.

ServiceImpl 클래스는 의존하는 DAOImpl 객체를 전달받지 위해 new 키워드를 사용해 객체를 생성하지 않고 생성자를 호출할 때 외부에서 객체를 주입 받아 사용했다. 소스 코드에서 new를 사용해 객체를 생성하는 것이 아니라 ServiceImpl 생성자를 호출할 때 컨테이너에 의해 주입되는 객체로 DAO 변수를 초기화한 것이다.

DI를 사용하면 객체의 의존 관계를 외부에서 설정한다. 스프링에서는 의존하는 객체를 컨테이너 실행 시 주입하기 때문에 DI라고 부른다. 여기서 각 클래스 객체를 bean(이하 빈)이라 부르는데, 이는 의존 관계를 설정하는 외부 XML 파일에서 각각의 객체를 `<bean>` 태그로 표시하기 때문이다.



## 의존성 주입 실습 [Textbook19]

스프링에서 의존 객체를 주입하는 방식은 생성자를 이용한 방식과 setter를 이용해 주입하는 방식이 있다.



## 회원 기능 이용해 DI 실습하기 [Textbook19]