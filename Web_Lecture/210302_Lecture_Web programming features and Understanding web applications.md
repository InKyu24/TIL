# 웹 프로그래밍과 JSP

## 웹 프로그래밍의 기본

일반적인 웹 페이지는 대부분 미리 서버에 등록해 두었다가 웹 브라우저가 서버에 특정 데이터를 요청하면 이를 웹 브라우저로 전송해서 보여준다. 이를 가능케 하는 기술 중 하나가 JSP(Java Server Page)이다.

JSP가 어느 순간 갑자기 나타난 것은 아니다. JSP가 나오기 전에도 웹 브라우저를 통해 웹 페이지를 보여주는 기능은 있었다. Apache 같은 웹 서버를 이용해서 웹 페이지들을 브라우저에 표시하는 방식이었다. 이러한 방식을 정적 웹 프로그래밍이라고 한다.

정적 웹 프로그래밍은 웹 서버에 미리 보여줄 HTML 페이지, CSS, 이미지, 자바스크립트 파일을 저장해 놓고 브라우저에서 요청할 경우 그래도 전달하는 방식이다. 따랏 ㅓ사용자는 페이지가 변경되지 않는 한 고정된 웹 페이지를 보게 된다. 요즘에는 환율 정보나 주가 정보 등 실시간으로 변하는 정보를 웹 페이지에 표시해야 할 일이 많기 때문에 이 방식은 거의 사용되지 않는다. 하지만 정적 웹 프로그래밍 구성 요서는 JSP에서도 화면 디자인과 기능 처리 부분에 있어서는 알아둘 필요가 있다.



## 정적 웹 프로그래밍

인터넷이 발전하면서 사용자들은 점차 웹 브라우저로 실시간 정보를 제공받길 원한다. 하지만 기존의 정적 웹 프로그램이 새로운 정보를 제공하기 위해서는 관리자가 HTML 페잊에서 해당 정보가 표시되는 곳을 찾아 정보를 수정한 후 해당 정보를 클라이언트에게 제공해야 한다. 이런 방식은 우베 기반 프로그램이 처음 나온 초기에는 간으했으나 지금처럼 사용자들에게 제공하는 정보의 변경 속도가 급속도로 빨라지고 있는 현실에서는 사실상 불가능하낟.

클라이언트는 실시간으로 변경되는 환율 정보는 원하는데, 바로 여기서 정적인 웹 프로그래밍 방식의 한계가 명백히 드러나는 것이다.

정적 웹 프로그래밍의 특징을 요약하면 다음과 같다.

+ 사용자에게 화면 디자인 같은 고정된 정보만을 제공한다.
+ 정보 수정 시 관리자가 직접 HTML 소스를 수정하여 사용자에게 정보를 제공한다.



## 동적 웹 프로그래밍

동적인 방식에서는 관리자가 하던 역할을 웹 애플리케이션 서버가 수행한다. 정확히는 웹 애플리케이션 서버(WAS)에서 실행되는 애플리케이션을 의미한다. 따라서 실시간 정보가 저장되어 있는 데이터베이스에 클라이언트 요청이 있을 때마다 데이터베이스에 접근하여 실시간 정보를 클라이언트에게 제공할 수 있게 되는 것이다.

처음에 동적인 방식으로 프로그램을 제공하는 기능은 CGI(Common Gate Interface, 공용 게이트웨이 인터페이스)였다. 프로그래밍 인어인 펄이 대표적인 CGI 프로그래밍 언어이다.

CGI 동작 방식의 대표적인 특징을 요약하면 다음과 같다.

+ 초기 웹 프로그램에서 사용하는 방식이다.
+ 프로세스 방식으로 실행된다.
+ 서버의 부하가 심하다.

+ 웹 애플리케이션 서버에서 실행되는 기능들이 모두 프로세스 방식으로 실행된다.

클라이언트가 실시간 정보를 요청하면 웹 애플리케이션 서버는 조회 기능을 수행하는 프로세스를 메모리에 생성하고 데이터베이스와 연동하여 클라이언트에게 정보를 반환한다. 그리고 다시 또 다른 클라이언트에게서 정보 요청을 받은 서버는 또 다시 조회기능을 하는 프로세스를 메모리에 생성한 후 기능을 수행한다.

이처럼 CGI 방식은 같은 기능을 수행하더라도 각 경우에 대해 처음부터 메모리에 기능을 로드하여 수행해야 한다. 초기 인터넷 환경에서는 사용자 수도 적고 수행해야 할 기능도 적어서 이런 방식의 실행은 문제가 없었다. 하지만 인터넷 환경이 발전하고 사용자 수가 급격히 늘어나 처리해야 할 일이 많은 상황에서 이런 방식으로 서비스한다면 메모리에 과부하가 걸려 기능 수행에 어려움이 생길 수 밖에 없다. 이러한 문제점을 개선하여 나온 것이 JSP, ASP, PHP와 같은 동적 웹 프로그래밍 기술이다.



## JSP 프로그램의 특징

JSP는 기본적으로 스레드 방식으로 실행하기 때문에 CGI 방식보다는 효율적으로 기능을 수행한다.

클라이언트가 실시간 정보를 요청하면 웹 애플리케이션 서버는 조회 기능을 메모리에 로드한 후 환율 정보를 얻어 와서 클라이언트에게 전송한다. 그리고 또 다른 클라이언트가 동일한 정보를 요청하면 이번에는 기존에 서비스를 담당했던 조회 기능이 기존 메모리에 존재하므로 다시 환율 정보를 가져오게 된다. 따라서 각각의 요청에 대한 기능을 메모리에 따로따로 로드할 필요가 없어진 것이다.

실제로 프로그램의 수행 속도를 떨어뜨리는 요인 중 하나가 프로그램을 외부 장치에서 메모리로 로드하는 것이다. 그런데 스레드로 수행하면 이 과정을 거치지 않아도 되니 기존 CGI 프로그램보다 훨씬 빠르게 동작할 수 있는 것이다.

요즘처럼 다수의 사용자가 접속해서 긴으을 수행해야 하는 환경에서는 JSP, ASP, PHP와 같이 스레드 방식으로 동작하는 프로그램이 유리하다. 따라서 현재 대부분의 웹 프로그램이 스레드 방식으로 동작한다고 보면 된다.

JSP의 동작 방식의 특징을 요약하면 다음과 같다.

+ 프로세스 방식이 아닌 스레드 방식으로 실행한다.
+ 클라이언트의 요구를 처리하는 기능은 최초 한 번만 메모리에 로드된다.
+ 클라이언트가 동일한 기능을 요구하면 기존에 사용한 기능을 재사용한다.



# 웹 애플리케이션 이해하기

## 웹 애플리케이션

웹 애플링케이션이란 말 그대로 기존의 정적인 웹 애플리케이션의 기능을 그대로 사용하면서 서블릿(Servlet, 자바로 만든 CGI 프로그램), JSP, 자바 클래스들을 추가하여 사용자에게 동적인 서비스를 제공하는 프로그램을 말한다.

즉, 웹 컨테이너에서 실행되는 JSP, 서블릿, 자바 클래스들을 사용해 정적 웹 프로그래밍 방식의 단점을 보완하여 서비스를 제공하는 서버 프로그램을 웹 애플리케이션이라고 한다. 따라서 정적 웹 애플리케이션의 기능인 HTML, 자바스크립트, CSS 등도 웹 애플리케이션에서 그대로 사용할 수 있다.



## 웹 애플리케이션의 기본 구조

톰캣과 같은 웹 컨테이너에서 실행하는 웹 애플리케이션의 기본 디렉터리 구조에 대해 살펴보자. 컨테이너에서 실행되는 웹 애플리케이션은 루트 디렉터리와 하위 디렉터리 구조를 기본 구조로 갖게 된다.

+ 웹 애플리케이션 이름
  + WEB-INF
    + classes
    + lib
    + web.xml

이러한 구조를 갖추지 않고 컨테이너에서 웹 애플리케이션을 실행하면 오류가 발생한다. 만약 기본 구조 외에 다른 기능이 추가되면 디렉터리를 추가해서 사용하면 된다.

+ WEB-INF : 웹 애플리케이션에 관한 정보가 저장되는 곳으로, 외부(브라우저)에서 접근 불가

+ classes : 웹 애플리케이션이 수행하는 서블릿과 다른 일반 클래스들이 위치하는 곳

+ lib : 웹 애플리케이션에서 사용되는 여러 가지 라이브러리 압축 파일(.jar)이 저장되는 곳으로, DB 연동 드라이버나 프레임워크 기능 관련 파일(.jar)이 여기에 저장된다. lib 디렉터리의 jar는 클래스패스가 자동으로 설정된다.

+ web.xml : 배치 지시자(deployment descriptor)로서 일종의 환경 설정 파일이다. 웹 애플리케이션에 대한 여러 가지 설정을 할 때 사용된다.



## 컨테이너에서 웹 애플리케이션 실행하기

간단한 웹 애플리케이션을 만들어 톰캣 컨테이너에서 실행한 후 웹 브라우저에서 요청하면 정상적으로 실행되는지 실습해보자. 이클립스에서 자동으로 한 번에 웹 애플리케이션을 만들 수도 있지만 그 전에 한 번쯤은 직접 웹 애플리케이션을 만들어보는 경험을 해보자.

### 컨테이너에 웹 애플리케이션 등록

웹 애플리케이션은 일반 PC에서 실행되는 자바 애플리케이션과 달리 단독으로 실행할 수 없다. 웹 애플리케이션은 톰캣과 같은 웹 컨테이너에서 실행되는 구조이기에 내가 만든 웹 애플리케이션을 실행하려면 우선 톰캣에 등록부터 해야한다.

웹 애플리케이션을 톰캣 컨테이너에 등록하는 방법은 두 가지가 있다.

1. %CATALINA_HOME%webApps 디렉터리에 애플리케이션을 저장

   설치한 톰캣 루트 디렉터리의 하위 디렉터리인 webapps 폴더에 작성한 웹 애플리케이션을 위치시킨 다음 톰캣을 재실행하면 톰캣이 자동으로 웹 애플리케이션을 인식한 후 실행하는 방법

2. server.xml에 직접 웹 애플리케이션을 등록

   임의의 장소에 위치해 있는 웹 애플리케이션을 톰캣의 설정 파일인 server.xml에 등록해서 실행하는 방법

### 톰캣 실행

톰캣을 설치한 루트 디렉터리의 bin 폴더로 이동해서, startup.bat을 실행해서 Server가 startup한 것을 확인한다.

### 브라우저에서 웹 애플리케이션 요청

이제 웹 브라우저 주소창에 `http://127.0.0.1:포트번호/컨텍스트이름/요청파일이름` 또는 `http://localhost:포트번호/컨텍스트이름/요청파일이름`을 입력하면 결과 화면을 확인할 수 있게 된다.

### 컨텍스트란?

실제 개발 과정에서는 수시로 애플리케이션을 실행하고 테스트해봐야 하는 일이 생긴다. 그 때마다 이렇게 프로젝트 파일을 통째로 복사해야 한다면 번거롭게 된다. 따라서 실제로 개발할 때에는 개발자가 정한 위치에 웹 애플리케이션을 생성한 후 그 위치를 server.xml에 등록해 놓고 톰캣을 실행하는 식으로 개발해야 한다. 그렇게 하면 톰캣이 server.xml에 입력된 정보에 따라 해당 위치로 이동하여 애플리케이션을 확인한 후 실행하게 된다.

여기서 server.xml에 등록하는 웹 애플리케이션을 컨텍스트(Context)라 부랍느다. 즉, 톰캣 입장에서 인식하는 한 개의 웹 애플리케이션이라고 보면 된다. 컨테이너 실행 시 웹 애플리케이션 당 하나의 컨텍스트가 생성된다. 컨텍스트 이름은 웹 애플리케이션 이름과 같게 만드는 것이 일반적이나 보안상의 이유 또는 웹 애플리케이션 이름이 긴 경우 등은 다르게 만들 수 있다.

컨텍스트의 주요 특징을 요약하면 다음과 같다.

+ 웹 애플리케이션 당 하나의 컨텍스트가 등록된다.
+ 웹 애플리케이션 이름과 같을 수도, 다를 수도 있다.
+ 컨텍스트 이름은 중복되면 안 된다.
+ 웹 애플리케이션의 의미를 가장 잘 나타낼 수 있는 명사형으로 지정한다.
+ 대소문자를 구분한다.
+ server.xml에 등록한다.

### 톰캣 컨테이너에 컨텍스트 등록하기

server.xml에 컨텍스트를 등록하기 위해서는 아래와 같이 `<Context>` 태그를 이용해야 한다. server.xml 파일은 톰캣 설치 루트 디렉터리 아래, conf 디렉터리 안에 있다.

```xml
<Context path="/컨텍스트이름"
         docBase="실제 웹 애플리케이션의 WEB-INF 디렉터리 위치"
         reloadable="true 또는 false" />
```

이제 톰캣을 설치한 루트 디렉터리의 bin 폴더로 이동해서, startup.bat을 실행해서 Server가 startup한 것을 확인한다.

웹 브라우저 주소창에 `http://127.0.0.1:포트번호/webMal/index.html` 또는 `http://localhost:포트번호/webMal/index.html`을 입력하면 결과 화면을 확인할 수 있게 된다.



### 톰캣 컨테이너에서의 웹 애플리케이션 동작 과정

톰캣 컨테이너에 웹 애플리케이션을 등록한 후 브라우저에서 요청할 경우 톰캣이 브라우저에 서비스하는 과정을 알아보자.

실제 웹 브라우저에서 컨텍스트 이름으로 요청할 경우 웹 애플리케이션이 동작하는 과정은 다음과 같다.

1. 웹 브라우저에서 컨텍스트 이름으로 요청한다.
2. 요청을 받은 톰캣 컨테이너는 요청한 컨텍스트 이름이 server.xml에 있는지 확인한다.
3. 해당 컨텍스트 이름이 있으면 컨텍스트 이름에 대한 실제 웹 애플리케이션이 있는 경우로 가서 요청한 index.html을 클라이언트 웹 브라우저로 전송한다.
4. 웹 브라우저는 전송된 index.html을 브라우저에 나타낸다.



## 웹 애플리케이션 서비스하기